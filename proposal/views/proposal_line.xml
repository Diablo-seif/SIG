<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="proposal_line_tree" model="ir.ui.view">
        <field name="name">proposal.line.tree</field>
        <field name="model">proposal.line</field>
        <field name="arch" type="xml">
            <list decoration-bf="amendment==True">
                <field name="sequence" widget="handle"/>
                <field name="product_id"/>
                <field name="name"/>
                <field name="uom_id"/>
                <field name="product_uom_qty" sum="Total QTY" optional="show"/>
                <field name="unit_cost"  options="{'currency_field': 'currency_id'}" sum="Total Unit Cost" groups="proposal.group_proposal_create_rfq,proposal.group_proposal_admin" optional="show"/>
                <field name="cost" widget="monetary" options="{'currency_field': 'currency_id'}" sum="Total Cost" groups="proposal.group_proposal_create_rfq,proposal.group_proposal_admin" optional="show"/>
                <field name="purchase_tax_ids" widget="many2many_tags" groups="proposal.group_proposal_create_rfq,proposal.group_proposal_admin" optional="show"/>
                <field name="purchase_taxes" sum="Purchase Taxes" groups="proposal.group_proposal_create_so,proposal.group_proposal_admin" optional="show"/>
                <field name="cost_after_taxes" sum="Cost After Taxes" groups="proposal.group_proposal_create_so,proposal.group_proposal_admin" optional="show"/>
                <field name="margin_percentage" widget="percentage" force_save="1" groups="proposal.group_proposal_create_so,proposal.group_proposal_admin" optional="show"/>
                <field name="margin_amount" widget="monetary" options="{'currency_field': 'currency_id'}" force_save="1" sum="Total Margin Amount" groups="proposal.group_proposal_create_so,proposal.group_proposal_admin" optional="show"/>
                <field name="unit_price" widget="monetary" options="{'currency_field': 'currency_id'}" sum="Total Unit Price" groups="proposal.group_proposal_create_so,proposal.group_proposal_admin" optional="show"/>
                <field name="price" widget="monetary" options="{'currency_field': 'currency_id'}" sum="Total Price" groups="proposal.group_proposal_create_so,proposal.group_proposal_admin" optional="show"/>
                <field name="sales_tax_ids" widget="many2many_tags" groups="proposal.group_proposal_create_so,proposal.group_proposal_admin" optional="show"/>
                <field name="sales_taxes" sum="Sales Taxes" groups="proposal.group_proposal_create_rfq,proposal.group_proposal_admin" optional="show"/>
                <field name="price_after_taxes" sum="Price After Taxes" groups="proposal.group_proposal_create_rfq,proposal.group_proposal_admin" optional="show"/>
                <field name="amendment" optional="show"/>
                <field name="proposal_state" optional="show"/>
            </list>
        </field>
    </record>

    <record id="proposal_line_pivot" model="ir.ui.view">
        <field name="name">proposal.line.pivot</field>
        <field name="model">proposal.line</field>
        <field name="arch" type="xml">
            <pivot>
                <field name="proposal_id" type="row"/>
                <field name="cost" type="measure"/>
                <field name="price" type="measure"/>
                <field name="margin_percentage" widget="percentage" type="measure"/>
                <field name="margin_amount" type="measure"/>
            </pivot>
        </field>
    </record>

    <record id="proposal_line_graph" model="ir.ui.view">
        <field name="name">proposal.line.graph</field>
        <field name="model">proposal.line</field>
        <field name="arch" type="xml">
            <graph>
                <field name="proposal_id" type="col"/>
                <field name="cost" type="measure"/>
                <field name="price" type="measure"/>
                <field name="margin_percentage" type="measure"/>
                <field name="margin_amount" type="measure"/>
            </graph>
        </field>
    </record>

    <record id="proposal_line_search" model="ir.ui.view">
        <field name="name">proposal.line.search</field>
        <field name="model">proposal.line</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <filter string="Amendment" name="filter_amendment" domain="[('amendment','=',True)]"/>
                <filter string="Original" name="filter_original" domain="[('amendment','=',False)]"/>
                <group expand="0" string="Group By">
                    <filter string="Proposal" name="group_proposal_id" context="{'group_by':'proposal_id'}"/>
                    <filter string="Amendment" name="group_amendment" context="{'group_by':'amendment'}"/>
                    <filter string="Product" name="group_product_id" context="{'group_by':'product_id'}"/>
                    <filter string="Proposal State" name="group_proposal_state" context="{'group_by':'proposal_state'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="proposal_line_action" model="ir.actions.act_window">
        <field name="name">Proposal Lines</field>
        <field name="res_model">proposal.line</field>
        <field name="view_mode">list,pivot,graph</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new document
            </p>
        </field>
        <field name="context">{'search_default_group_proposal_id': '1', 'create': 0, 'edit': 0, 'delete': 0}</field>
        <field name="domain">[('display_type', '=', False)]</field>
    </record>

    <menuitem id="proposal_line_menu"
            name="Proposal Line"
            action="proposal_line_action"
            parent="proposal_main_menu"
            sequence="5"/>

</odoo>
